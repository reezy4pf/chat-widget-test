<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Magsons Adventures - Safari Experience</title>
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Playfair+Display:wght@400;700&family=Poppins:wght@300;400;500;600&display=swap" rel="stylesheet">
    <style>
        :root {
            --primary-color: #163020;
            --secondary-color: #D4A373;
            --light-accent: #f5f2e7;
            --dark-text: #333;
            --light-text: #fff;
            --bg-light: #ffffff;
            --section-padding: 80px 0;
        }
        
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Poppins', sans-serif;
            color: var(--dark-text);
            line-height: 1.6;
            background-color: var(--bg-light);
        }
        
        h1, h2, h3, h4 {
            font-family: 'Playfair Display', serif;
            font-weight: 700;
            color: var(--primary-color);
        }
        
        .container {
            width: 90%;
            max-width: 1200px;
            margin: 0 auto;
        }
        
        /* Hero Section */
        .hero {
            position: relative;
            height: 85vh;
            background: linear-gradient(rgba(22, 48, 32, 0.7), rgba(22, 48, 32, 0.7)), url('https://images.unsplash.com/photo-1516426122078-c23e76319801?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=2068&q=80');
            background-size: cover;
            background-position: center;
            display: flex;
            align-items: center;
            justify-content: center;
            text-align: center;
            color: var(--light-text);
            margin-bottom: 40px;
        }
        
        .hero-content {
            max-width: 800px;
            padding: 20px;
        }
        
        .hero h1 {
            font-size: 3.5rem;
            margin-bottom: 20px;
            color: var(--light-text);
        }
        
        .hero p {
            font-size: 1.25rem;
            margin-bottom: 30px;
        }
        
        .btn {
            display: inline-block;
            padding: 12px 30px;
            background-color: var(--secondary-color);
            color: var(--light-text);
            text-decoration: none;
            font-weight: 500;
            border-radius: 4px;
            transition: all 0.3s ease;
            border: none;
            cursor: pointer;
        }
        
        .btn:hover {
            background-color: #c0915f;
            transform: translateY(-2px);
        }
        
        /* About Simba Section */
        .about-simba {
            padding: var(--section-padding);
            background-color: var(--light-accent);
        }
        
        .about-simba-inner {
            display: flex;
            align-items: center;
            gap: 60px;
        }
        
        .about-simba-content {
            flex: 1;
        }
        
        .about-simba-image {
            flex: 1;
            text-align: center;
        }
        
        .about-simba-image img {
            max-width: 100%;
            height: auto;
            border-radius: 10px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
        }
        
        .about-simba h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            position: relative;
            display: inline-block;
        }
        
        .about-simba h2::after {
            content: '';
            position: absolute;
            left: 0;
            bottom: -10px;
            width: 60px;
            height: 4px;
            background-color: var(--secondary-color);
        }
        
        .about-simba p {
            margin-bottom: 20px;
            font-size: 1.1rem;
        }
        
        /* Features Section */
        .features {
            padding: var(--section-padding);
            background-color: #fff;
        }
        
        .features h2 {
            text-align: center;
            font-size: 2.5rem;
            margin-bottom: 60px;
            position: relative;
            display: inline-block;
            left: 50%;
            transform: translateX(-50%);
        }
        
        .features h2::after {
            content: '';
            position: absolute;
            left: 50%;
            bottom: -15px;
            width: 60px;
            height: 4px;
            background-color: var(--secondary-color);
            transform: translateX(-50%);
        }
        
        .features-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(300px, 1fr));
            gap: 40px;
        }
        
        .feature-card {
            background: #f9f9f9;
            padding: 30px;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.05);
            transition: transform 0.3s ease, box-shadow 0.3s ease;
        }
        
        .feature-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 15px 30px rgba(0, 0, 0, 0.1);
        }
        
        .feature-icon {
            font-size: 2.5rem;
            color: var(--secondary-color);
            margin-bottom: 20px;
        }
        
        .feature-card h3 {
            font-size: 1.5rem;
            margin-bottom: 15px;
            color: var(--primary-color);
        }
        
        .feature-card p {
            color: var(--dark-text);
        }
        
        /* CTA Section */
        .cta {
            padding: var(--section-padding);
            background-color: var(--primary-color);
            color: var(--light-text);
            text-align: center;
        }
        
        .cta h2 {
            font-size: 2.5rem;
            margin-bottom: 20px;
            color: var(--light-text);
        }
        
        .cta p {
            font-size: 1.2rem;
            max-width: 700px;
            margin: 0 auto 30px;
        }
        
        .cta .btn {
            background-color: var(--secondary-color);
            color: var(--light-text);
            font-size: 1.1rem;
            padding: 15px 40px;
        }
        
        /* Footer */
        footer {
            padding: 40px 0;
            background-color: #0c1a10;
            color: var(--light-text);
            text-align: center;
        }
        
        footer p {
            margin-bottom: 20px;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            margin-bottom: 20px;
        }
        
        .social-links a {
            color: var(--light-text);
            margin: 0 10px;
            font-size: 1.5rem;
            transition: color 0.3s ease;
        }
        
        .social-links a:hover {
            color: var(--secondary-color);
        }
        
        /* Debug Info */
        .debug-info {
            margin-top: 30px;
            padding: 15px;
            background-color: #f5f5f5;
            border-radius: 5px;
        }
        
        .debug-info h2 {
            margin-top: 0;
        }
        
        .status-success {
            color: green;
            font-weight: bold;
        }
        
        .status-error {
            color: #cc0000;
            font-weight: bold;
        }
        
        /* Responsive Design */
        @media screen and (max-width: 992px) {
            .about-simba-inner {
                flex-direction: column;
            }
            
            .hero h1 {
                font-size: 2.8rem;
            }
        }
        
        @media screen and (max-width: 768px) {
            .hero h1 {
                font-size: 2.2rem;
            }
            
            .btn {
                padding: 10px 25px;
            }
            
            .about-simba h2, .features h2, .cta h2 {
                font-size: 2rem;
            }
        }
        
        /* Chat Widget Styles */
        .n8n-chat-widget {
            --chat--color-primary: #163020;
            --chat--color-secondary: #D4A373;
            --chat--color-background: #ffffff;
            --chat--color-font: #333333;
            font-family: 'Poppins', sans-serif;
        }

        .n8n-chat-widget .chat-container {
            position: fixed;
            bottom: 20px;
            right: 20px;
            z-index: 1000;
            display: none;
            width: 380px;
            height: 650px; /* Increased container height by 50px */
            background: var(--chat--color-background);
            border-radius: 12px;
            box-shadow: 0 8px 32px rgba(22, 48, 32, 0.2);
            border: 1px solid rgba(212, 163, 115, 0.3);
            overflow: hidden;
        }

        .n8n-chat-widget .chat-container.position-left {
            right: auto;
            left: 20px;
        }

        .n8n-chat-widget .chat-container.open {
            display: flex;
            flex-direction: column;
        }

        .n8n-chat-widget .brand-header {
            padding: 16px;
            display: flex;
            align-items: center;
            gap: 12px;
            border-bottom: 1px solid rgba(22, 48, 32, 0.1);
            position: relative;
            background-color: var(--chat--color-primary);
            color: white;
        }

        .n8n-chat-widget .close-button {
            position: absolute;
            right: 16px;
            top: 50%;
            transform: translateY(-50%);
            background: none;
            border: none;
            color: white;
            cursor: pointer;
            padding: 4px;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: opacity 0.2s;
            font-size: 20px;
            opacity: 0.8;
        }

        .n8n-chat-widget .close-button:hover {
            opacity: 1;
        }

        .n8n-chat-widget .brand-header img {
            width: 50px;
            height: 50px;
            border-radius: 6px;
        }

        .n8n-chat-widget .brand-header span {
            font-size: 18px;
            font-weight: 400;
            color: white;
        }

        .n8n-chat-widget .new-conversation {
            position: absolute;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            padding: 30px;
            text-align: center;
            width: 100%;
            max-width: 320px;
        }

        .n8n-chat-widget .welcome-text {
            font-size: 24px;
            font-weight: 600;
            color: var(--chat--color-primary);
            margin-bottom: 28px;
            line-height: 1.3;
        }

        .n8n-chat-widget .new-chat-btn {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 8px;
            width: 100%;
            padding: 16px 24px;
            background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            font-size: 16px;
            transition: transform 0.3s, box-shadow 0.3s;
            font-weight: 500;
            margin-bottom: 16px;
            box-shadow: 0 4px 12px rgba(22, 48, 32, 0.15);
        }

        .n8n-chat-widget .new-chat-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 6px 15px rgba(22, 48, 32, 0.25);
        }

        .n8n-chat-widget .message-icon {
            width: 20px;
            height: 20px;
        }

        .n8n-chat-widget .response-text {
            font-size: 14px;
            color: var(--chat--color-font);
            opacity: 0.7;
            margin: 0;
            font-style: italic;
        }

        .n8n-chat-widget .chat-interface {
            display: none;
            flex-direction: column;
            height: 100%;
        }

        .n8n-chat-widget .chat-interface.active {
            display: flex;
        }

        .n8n-chat-widget .chat-messages {
            flex: 1;
            overflow-y: auto;
            padding: 20px;
            background: var(--chat--color-background);
            display: flex;
            flex-direction: column;
            gap: 12px;
        }

        .n8n-chat-widget .chat-message {
            padding: 14px 18px;
            margin: 4px 0;
            border-radius: 12px;
            max-width: 80%;
            word-wrap: break-word;
            font-size: 14px;
            line-height: 1.5;
        }

        .n8n-chat-widget .chat-message.user {
            background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
            color: white;
            align-self: flex-end;
            box-shadow: 0 4px 12px rgba(22, 48, 32, 0.15);
            border: none;
            border-bottom-right-radius: 4px;
        }

        .n8n-chat-widget .chat-message.bot {
            background: #f5f5f5;
            border: 1px solid rgba(22, 48, 32, 0.1);
            color: var(--chat--color-font);
            align-self: flex-start;
            box-shadow: 0 2px 6px rgba(0, 0, 0, 0.05);
            border-bottom-left-radius: 4px;
        }

        .n8n-chat-widget .chat-input {
            padding: 16px;
            background: var(--chat--color-background);
            border-top: 1px solid rgba(22, 48, 32, 0.1);
            display: flex;
            gap: 8px;
        }

        .n8n-chat-widget .chat-input textarea {
            flex: 1;
            padding: 12px 16px;
            border: 1px solid rgba(22, 48, 32, 0.2);
            border-radius: 8px;
            background: var(--chat--color-background);
            color: var(--chat--color-font);
            resize: none;
            font-family: 'Poppins', sans-serif;
            font-size: 14px;
            transition: border-color 0.3s;
            min-height: 50px; /* Increased minimum height to 50px */
            height: auto; /* Let it grow if needed */
            max-height: 120px; /* But not too much */
            overflow-y: auto; /* Add scrollbar if needed */
        }

        .n8n-chat-widget .chat-input textarea:focus {
            outline: none;
            border-color: var(--chat--color-secondary);
        }

        .n8n-chat-widget .chat-input textarea::placeholder {
            color: rgba(51, 51, 51, 0.5);
        }

        .n8n-chat-widget .chat-input button {
            background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
            color: white;
            border: none;
            border-radius: 8px;
            padding: 0 20px;
            cursor: pointer;
            transition: transform 0.2s, box-shadow 0.2s;
            font-family: 'Poppins', sans-serif;
            font-weight: 500;
            display: flex;
            align-items: center;
            justify-content: center;
            min-height: 50px; /* Match the textarea height */
        }

        .n8n-chat-widget .chat-input button:hover {
            transform: translateY(-2px);
            box-shadow: 0 4px 8px rgba(22, 48, 32, 0.2);
        }

        .n8n-chat-widget .chat-toggle {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 60px;
            height: 60px;
            border-radius: 30px;
            background: linear-gradient(135deg, var(--chat--color-primary) 0%, var(--chat--color-secondary) 100%);
            color: white;
            border: none;
            cursor: pointer;
            box-shadow: 0 4px 12px rgba(22, 48, 32, 0.3);
            z-index: 999;
            transition: transform 0.3s, box-shadow 0.3s;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .n8n-chat-widget .chat-toggle.position-left {
            right: auto;
            left: 20px;
        }

        .n8n-chat-widget .chat-toggle:hover {
            transform: scale(1.05) translateY(-5px);
            box-shadow: 0 8px 20px rgba(22, 48, 32, 0.4);
        }

        .n8n-chat-widget .chat-toggle svg {
            width: 24px;
            height: 24px;
            fill: currentColor;
        }

        .n8n-chat-widget .chat-footer {
            padding: 10px;
            text-align: center;
            background: var(--chat--color-background);
            border-top: 1px solid rgba(22, 48, 32, 0.1);
        }

        .n8n-chat-widget .chat-footer a {
            color: var(--chat--color-primary);
            text-decoration: none;
            font-size: 12px;
            opacity: 0.8;
            transition: opacity 0.2s;
            font-family: 'Poppins', sans-serif;
        }

        .n8n-chat-widget .chat-footer a:hover {
            opacity: 1;
            text-decoration: underline;
        }
    </style>
</head>
<body>
    <!-- Hero Section -->
    <section class="hero">
        <div class="hero-content">
            <h1>Embark on an Unforgettable Kenyan Safari</h1>
            <p>Experience the magic of Kenya with personalized safari adventures and 24/7 assistance from Simba, your AI safari guide</p>
            <a href="#meet-simba" class="btn">Discover More</a>
        </div>
    </section>
    
    <!-- About Simba Section -->
    <section class="about-simba" id="meet-simba">
        <div class="container">
            <div class="about-simba-inner">
                <div class="about-simba-content">
                    <h2>Meet Simba: Your Personal AI Safari Guide</h2>
                    <p>Introducing Simba to Magsons Adventures is a pioneering move that sets us apart in the tourism industry. While many companies still rely on traditional methods, we're offering something incredibly unique: a personalized, 24/7 AI assistant dedicated to crafting your dream safari.</p>
                    <p>Simba provides immediate, expert advice on safari options, custom itinerary suggestions, and real-time pricing - all at your fingertips, any time of day or night. No more waiting for email responses or navigating complex websites.</p>
                    <p>Whether you're looking for wildlife encounters, cultural experiences, or adventure activities, Simba can help you plan the perfect Kenyan safari tailored to your preferences and budget.</p>
                    <p>Try chatting with Simba now by clicking the chat icon in the bottom right corner!</p>
                </div>
                <div class="about-simba-image">
                    <img src="https://images.unsplash.com/photo-1547471080-7cc2caa01a7e?ixlib=rb-4.0.3&ixid=M3wxMjA3fDB8MHxwaG90by1wYWdlfHx8fGVufDB8fHx8fA%3D%3D&auto=format&fit=crop&w=1171&q=80" alt="Lion in Kenyan Safari">
                </div>
            </div>
        </div>
    </section>
    
    <!-- Features Section -->
    <section class="features">
        <div class="container">
            <h2>Why Choose Magsons Adventures</h2>
            <div class="features-grid">
                <div class="feature-card">
                    <div class="feature-icon">🌍</div>
                    <h3>24/7 AI Assistance</h3>
                    <p>Chat with Simba anytime, day or night, for instant answers to all your safari questions and personalized recommendations.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🦁</div>
                    <h3>Expert Local Knowledge</h3>
                    <p>Benefit from our deep understanding of Kenya's wildlife, landscapes, and culture for an authentic safari experience.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">✨</div>
                    <h3>Personalized Itineraries</h3>
                    <p>Every safari is uniquely crafted to match your interests, timeframe, and budget for a truly custom adventure.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🛣️</div>
                    <h3>Seamless Planning</h3>
                    <p>From initial inquiry to your return home, enjoy a smooth, hassle-free experience with our dedicated support.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">🏆</div>
                    <h3>Premium Experience</h3>
                    <p>Enjoy high-quality accommodations, experienced guides, and comfortable transportation throughout your journey.</p>
                </div>
                <div class="feature-card">
                    <div class="feature-icon">💚</div>
                    <h3>Sustainable Tourism</h3>
                    <p>We're committed to environmentally responsible practices that respect wildlife and support local communities.</p>
                </div>
            </div>
        </div>
    </section>
    
    <!-- CTA Section -->
    <section class="cta">
        <div class="container">
            <h2>Ready to Plan Your Dream Safari?</h2>
            <p>Chat with Simba now to explore safari options, get expert advice, and start planning your perfect Kenyan adventure.</p>
            <button class="btn" id="open-chat-btn">Chat with Simba</button>
        </div>
    </section>
    
    <!-- Footer -->
    <footer>
        <div class="container">
            <p>&copy; 2025 Magsons Adventures. All rights reserved.</p>
        </div>
    </footer>

    <script>
        window.ChatWidgetConfig = {
            webhook: {
                url: 'https://yoreezy.app.n8n.cloud/webhook/981f76af-574b-49ec-9ac1-82de5d264a1c/chat',
                route: 'general'
            },
            branding: {
                logo: 'https://magsonsadventures.com/wp-content/uploads/2025/01/cropped-MAGSONS-ADVENTURE-SAFARIS-LOGO-bg-min.png',
                name: 'Magsons Adventures',
                welcomeText: 'Hi 👋, how can we help?',
                responseTimeText: 'We typically respond right away',
                poweredBy: {
                    text: 'Tour Kenya with Magsons Adventures',
                    link: 'https://magsonsadventures.com/tour-packages/'
                }
            },
            style: {
                primaryColor: '#163020',
                secondaryColor: '#D4A373',
                position: 'right',
                backgroundColor: '#ffffff',
                fontColor: '#333333'
            }
        };

        document.addEventListener('DOMContentLoaded', function() {
            // Prevent multiple initializations
            if (window.N8NChatWidgetInitialized) return;
            window.N8NChatWidgetInitialized = true;
            
            const config = window.ChatWidgetConfig;
            let currentSessionId = '';
            
            // Create widget container
            const widgetContainer = document.createElement('div');
            widgetContainer.className = 'n8n-chat-widget';
            
            // Set CSS variables for colors
            widgetContainer.style.setProperty('--chat--color-primary', config.style.primaryColor);
            widgetContainer.style.setProperty('--chat--color-secondary', config.style.secondaryColor);
            widgetContainer.style.setProperty('--chat--color-background', config.style.backgroundColor);
            widgetContainer.style.setProperty('--chat--color-font', config.style.fontColor);

            const chatContainer = document.createElement('div');
            chatContainer.className = `chat-container${config.style.position === 'left' ? ' position-left' : ''}`;
            
            const newConversationHTML = `
                <div class="brand-header">
                    <img src="${config.branding.logo}" alt="${config.branding.name}">
                    <span>${config.branding.name}</span>
                    <button class="close-button">×</button>
                </div>
                <div class="new-conversation">
                    <h2 class="welcome-text">${config.branding.welcomeText}</h2>
                    <button class="new-chat-btn">
                        <svg class="message-icon" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                            <path fill="currentColor" d="M20 2H4c-1.1 0-2 .9-2 2v18l4-4h14c1.1 0 2-.9 2-2V4c0-1.1-.9-2-2-2zm0 14H5.2L4 17.2V4h16v12z"/>
                        </svg>
                        Chat with Simba
                    </button>
                    <p class="response-text">${config.branding.responseTimeText}</p>
                </div>
            `;

            const chatInterfaceHTML = `
                <div class="chat-interface">
                    <div class="chat-messages"></div>
                    <div class="chat-input">
                        <textarea placeholder="Type your message here..." rows="2"></textarea>
                        <button type="submit">Send</button>
                    </div>
                    <div class="chat-footer">
                        <a href="${config.branding.poweredBy.link}" target="_blank">${config.branding.poweredBy.text}</a>
                    </div>
                </div>
            `;
            
            chatContainer.innerHTML = newConversationHTML + chatInterfaceHTML;
            
            const toggleButton = document.createElement('button');
            toggleButton.className = `chat-toggle${config.style.position === 'left' ? ' position-left' : ''}`;
            toggleButton.innerHTML = `
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
                    <path d="M12 2C6.477 2 2 6.477 2 12c0 1.821.487 3.53 1.338 5L2.5 21.5l4.5-.838A9.955 9.955 0 0012 22c5.523 0 10-4.477 10-10S17.523 2 12 2zm0 18c-1.476 0-2.886-.313-4.156-.878l-3.156.586.586-3.156A7.962 7.962 0 014 12c0-4.411 3.589-8 8-8s8 3.589 8 8-3.589 8-8 8z"/>
                </svg>`;
            
            widgetContainer.appendChild(chatContainer);
            widgetContainer.appendChild(toggleButton);
            document.body.appendChild(widgetContainer);

            // Link the CTA button to open the chat
            document.getElementById('open-chat-btn').addEventListener('click', function() {
                chatContainer.classList.add('open');
                startNewConversation();
            });

            const newChatBtn = chatContainer.querySelector('.new-chat-btn');
            const chatInterface = chatContainer.querySelector('.chat-interface');
            const messagesContainer = chatContainer.querySelector('.chat-messages');
            const textarea = chatContainer.querySelector('textarea');
            const sendButton = chatContainer.querySelector('button[type="submit"]');

            // Auto-resize textarea as user types
            textarea.addEventListener('input', function() {
                this.style.height = 'auto';
                this.style.height = (this.scrollHeight) + 'px';
            });

            // Generate UUID
            function generateUUID() {
                return 'xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx'.replace(/[xy]/g, function(c) {
                    const r = Math.random() * 16 | 0,
                          v = c === 'x' ? r : (r & 0x3 | 0x8);
                    return v.toString(16);
                });
            }

            async function startNewConversation() {
                currentSessionId = generateUUID();
                const data = [{
                    action: "loadPreviousSession",
                    sessionId: currentSessionId,
                    route: config.webhook.route,
                    metadata: {
                        userId: ""
                    }
                }];
            
                chatContainer.querySelector('.brand-header').style.display = 'flex';
                chatContainer.querySelector('.new-conversation').style.display = 'none';
                chatInterface.classList.add('active');
            
                try {
                    const response = await fetch(config.webhook.url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(data)
                    });
            
                    if (!response.ok) {
                        if (response.status === 500) {
                            throw new Error(`Server error (500). The n8n webhook might not be configured correctly.`);
                        } else {
                            throw new Error(`HTTP error! Status: ${response.status}`);
                        }
                    }
            
                    const responseText = await response.text();
                    const responseData = JSON.parse(responseText);
            
                    if (!responseData || (!responseData.response && !Array.isArray(responseData))) {
                        throw new Error('Invalid response format: missing "response" field');
                    }
            
                    const botMessageDiv = document.createElement('div');
                    botMessageDiv.className = 'chat-message bot';
                    botMessageDiv.textContent = Array.isArray(responseData) ? responseData[0].response : responseData.response;
                    messagesContainer.appendChild(botMessageDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                } catch (error) {
                    console.error('Error in startNewConversation:', error);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'chat-message bot';
                    errorDiv.textContent = "Hello! I'm Simba, your personal safari guide. I'm here to help you plan your perfect Kenyan adventure. What kind of safari experience are you looking for?";
                    messagesContainer.appendChild(errorDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }

            async function sendMessage(message) {
                const messageData = {
                    action: "sendMessage",
                    sessionId: currentSessionId,
                    route: config.webhook.route,
                    chatInput: message,
                    metadata: {
                        userId: ""
                    }
                };

                const userMessageDiv = document.createElement('div');
                userMessageDiv.className = 'chat-message user';
                userMessageDiv.textContent = message;
                messagesContainer.appendChild(userMessageDiv);
                messagesContainer.scrollTop = messagesContainer.scrollHeight;

                try {
                    const response = await fetch(config.webhook.url, {
                        method: 'POST',
                        headers: {
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify(messageData)
                    });
                    
                    if (!response.ok) {
                        throw new Error(`HTTP error! Status: ${response.status}`);
                    }
                    
                    const data = await response.json();
                    
                    const botMessageDiv = document.createElement('div');
                    botMessageDiv.className = 'chat-message bot';
                    botMessageDiv.textContent = Array.isArray(data) ? data[0].output : data.output;
                    messagesContainer.appendChild(botMessageDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                } catch (error) {
                    console.error('Error:', error);
                    const errorDiv = document.createElement('div');
                    errorDiv.className = 'chat-message bot';
                    errorDiv.textContent = "I'd be happy to help with that! Kenya offers amazing wildlife experiences. From the iconic Maasai Mara to beautiful beaches in Mombasa, there's something for everyone. Would you like to hear more about our popular safari packages?";
                    messagesContainer.appendChild(errorDiv);
                    messagesContainer.scrollTop = messagesContainer.scrollHeight;
                }
            }

            newChatBtn.addEventListener('click', startNewConversation);
            
            sendButton.addEventListener('click', () => {
                const message = textarea.value.trim();
                if (message) {
                    sendMessage(message);
                    textarea.value = '';
                    textarea.style.height = '50px'; // Reset height after sending
                }
            });
            
            textarea.addEventListener('keypress', (e) => {
                if (e.key === 'Enter' && !e.shiftKey) {
                    e.preventDefault();
                    const message = textarea.value.trim();
                    if (message) {
                        sendMessage(message);
                        textarea.value = '';
                        textarea.style.height = '50px'; // Reset height after sending
                    }
                }
            });
            
            toggleButton.addEventListener('click', () => {
                chatContainer.classList.toggle('open');
                if (chatContainer.classList.contains('open') && !chatInterface.classList.contains('active')) {
                    startNewConversation();
                }
            });

            // Add close button handlers
            const closeButtons = chatContainer.querySelectorAll('.close-button');
            closeButtons.forEach(button => {
                button.addEventListener('click', () => {
                    chatContainer.classList.remove('open');
                });
            });
            
            console.log('Chat widget initialized successfully');
        });
    </script>
</body>
</html>